{
  "info": {
    "_postman_id": "e6c9c4c5-oral-demo-collection",
    "name": "UE-AD-A1-MIXTE - Collection Compl√®te",
    "description": "Collection Postman couvrant tous les services (User REST, Movie & Booking GraphQL, Schedule gRPC) + sc√©narios de d√©mo pr√™ts pour l'oral.",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "item": [
    {
      "name": "üé¨ D√âMO ORAL - Sc√©nario Utilisateur",
      "description": "1. Cr√©er une r√©servation (Movie + Schedule + MongoDB)\n2. Consulter les r√©servations d√©taill√©es (enrichissement Movie + Schedule)",
      "item": [
        {
          "name": "1Ô∏è‚É£ Cr√©er une r√©servation",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"mutation { create_booking(input: { userid: \\\"peter_curley\\\", movieid: \\\"720d006c-3a57-4b6a-b18f-9b713b073f3c\\\", date: \\\"20151203\\\" }) { message booking { userid movieid date } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3201/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3201",
              "path": ["graphql"]
            },
            "description": "Booking v√©rifie Movie (GraphQL) + Schedule (gRPC) puis √©crit dans MongoDB."
          }
        },
        {
          "name": "2Ô∏è‚É£ Voir r√©servations d√©taill√©es",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"query { detailed_bookings_by_user(userid: \\\"peter_curley\\\") { userid bookings { date movies { movie { id title rating director } schedule { date movies } } } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3201/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3201",
              "path": ["graphql"]
            },
            "description": "Retourne chaque r√©servation enrichie avec les d√©tails Movie + Schedule."
          }
        }
      ]
    },
    {
      "name": "üëë D√âMO ORAL - Sc√©nario Administrateur",
      "description": "1. Voir toutes les r√©servations (admin)\n2. Mettre √† jour un film (admin)\n3. Ajouter un film avec ID unique (admin)\n4. Montre l'erreur d'un non-admin",
      "item": [
        {
          "name": "1Ô∏è‚É£ Voir toutes les r√©servations (admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"query { all_bookings(userid: \\\"chris_rivers\\\") { userid dates { date movies } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3201/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3201",
              "path": ["graphql"]
            },
            "description": "Booking v√©rifie le r√¥le admin via User (REST) avant de retourner toutes les r√©servations."
          }
        },
        {
          "name": "2Ô∏è‚É£ Mettre √† jour la note d'un film (admin)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"mutation { update_movie_rating(id: \\\"267eedb8-0f5d-42d5-8f43-72426b9fb3e6\\\", rating: 9.1, author: \\\"chris_rivers\\\") { message movie { id title rating } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3001/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3001",
              "path": ["graphql"]
            },
            "description": "Movie appelle User (REST) pour v√©rifier les droits admin avant d'√©crire dans MongoDB."
          }
        },
        {
          "name": "3Ô∏è‚É£ Ajouter un film (admin, ID unique)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"mutation { add_movie(movie: { id: \\\"demo-movie-{{timestamp}}\\\", title: \\\"Nouveau Film Demo\\\", rating: 8.5, director: \\\"Realisateur Demo\\\", author: \\\"chris_rivers\\\" }) { message movie { id title rating director } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3001/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3001",
              "path": ["graphql"]
            },
            "description": "Utilise {{timestamp}} pour √©viter les collisions d'ID lors de d√©monstrations r√©p√©t√©es."
          }
        },
        {
          "name": "4Ô∏è‚É£ Ajouter un film (non-admin) ‚Üí erreur attendue",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"mutation { add_movie(movie: { id: \\\"demo-movie-non-admin\\\", title: \\\"Film Non Autoris√©\\\", rating: 5.0, director: \\\"Test\\\", author: \\\"garret_heaton\\\" }) { message movie { id title } } }\"\n}"
            },
            "url": {
              "raw": "http://localhost:3001/graphql",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3001",
              "path": ["graphql"]
            },
            "description": "Doit retourner ¬´ Acc√®s refus√©, administrateur requis ¬ª."
          }
        }
      ]
    },
    {
      "name": "User Service (REST)",
      "description": "API Flask exposant les utilisateurs stock√©s dans MongoDB (port 3203).",
      "item": [
        {
          "name": "GET / (home)",
          "request": {
            "method": "GET",
            "url": "http://localhost:3203/"
          }
        },
        {
          "name": "GET /users",
          "request": {
            "method": "GET",
            "url": "http://localhost:3203/users",
            "description": "Liste tous les utilisateurs."
          }
        },
        {
          "name": "GET /users/{id}",
          "request": {
            "method": "GET",
            "url": "http://localhost:3203/users/chris_rivers",
            "description": "Exemple avec un administrateur."
          }
        },
        {
          "name": "GET /users/admin",
          "request": {
            "method": "GET",
            "url": "http://localhost:3203/users/admin",
            "description": "Filtre uniquement les comptes avec r√¥le ¬´ admin ¬ª."
          }
        },
        {
          "name": "POST /users",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"id\": \"demo_user\",\n  \"name\": \"Utilisateur D√©mo\",\n  \"last_active\": 1360032000,\n  \"role\": \"user\"\n}"
            },
            "url": "http://localhost:3203/users",
            "description": "Ajoute un utilisateur test dans MongoDB (contr√¥les c√¥t√© API)."
          }
        }
      ]
    },
    {
      "name": "Movie Service (GraphQL)",
      "description": "Service Ariadne (port 3001) exposant les films.",
      "item": [
        {
          "name": "Home",
          "request": {
            "method": "GET",
            "url": "http://localhost:3001/"
          }
        },
        {
          "name": "Query - all_movies",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"query { all_movies { id title rating director } }\"\n}"
            },
            "url": "http://localhost:3001/graphql"
          }
        },
        {
          "name": "Query - movie_by_id (Creed)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"query { movie_by_id(id: \\\"267eedb8-0f5d-42d5-8f43-72426b9fb3e6\\\") { id title rating director } }\"\n}"
            },
            "url": "http://localhost:3001/graphql"
          }
        }
      ]
    },
    {
      "name": "Booking Service (GraphQL)",
      "description": "Service Ariadne (port 3201) orchestrant Movie + Schedule + User.",
      "item": [
        {
          "name": "Home",
          "request": {
            "method": "GET",
            "url": "http://localhost:3201/"
          }
        },
        {
          "name": "Query - bookings_by_user (chris_rivers)",
          "request": {
            "method": "POST",
            "header": [
              { "key": "Content-Type", "value": "application/json" }
            ],
            "body": {
              "mode": "raw",
              "raw": "{\n  \"query\": \"query { bookings_by_user(userid: \\\"chris_rivers\\\") { userid dates { date movies } } }\"\n}"
            },
            "url": "http://localhost:3201/graphql"
          }
        }
      ]
    },
    {
      "name": "üì° Schedule Service (gRPC)",
      "description": "‚ö†Ô∏è IMPORTANT : gRPC ne peut PAS √™tre test√© avec une requ√™te HTTP standard dans Postman.\n\nüìã OPTION 1 - Postman gRPC Client (Postman v9+) :\n1. Cliquez sur \"New\" > \"gRPC Request\"\n2. Host : `localhost:3002`\n3. Importez le fichier `schedule/schedule.proto`\n4. S√©lectionnez la m√©thode (ex: `schedule.Schedule/GetByDate`)\n5. Entrez le payload JSON (ex: `{ \"date\": \"20151201\" }`)\n\nüìã OPTION 2 - grpcurl (CLI) :\nInstallez grpcurl : https://github.com/fullstorydev/grpcurl\n\nExemples de commandes :\n\n‚Ä¢ GetAll :\ngrpcurl -plaintext localhost:3002 schedule.Schedule/GetAll\n\n‚Ä¢ GetByDate :\ngrpcurl -plaintext -d '{\"date\":\"20151201\"}' localhost:3002 schedule.Schedule/GetByDate\n\n‚Ä¢ AddToSchedule :\ngrpcurl -plaintext -d '{\"date\":\"20151201\",\"id\":\"720d006c-3a57-4b6a-b18f-9b713b073f3c\"}' localhost:3002 schedule.Schedule/AddToSchedule\n\n‚Ä¢ RemoveFromSchedule :\ngrpcurl -plaintext -d '{\"date\":\"20151201\",\"id\":\"720d006c-3a57-4b6a-b18f-9b713b073f3c\"}' localhost:3002 schedule.Schedule/RemoveFromSchedule\n\nüìÅ Fichier proto : `schedule/schedule.proto`",
      "item": [
        {
          "name": "‚ö†Ô∏è Note - gRPC n√©cessite le client gRPC",
          "request": {
            "method": "GET",
            "header": [],
            "url": {
              "raw": "http://localhost:3002/",
              "protocol": "http",
              "host": ["localhost"],
              "port": "3002",
              "path": [""]
            },
            "description": "Cette requ√™te HTTP ne fonctionnera PAS car gRPC utilise HTTP/2 et un protocole binaire.\n\nUtilisez plut√¥t :\n1. Le client gRPC de Postman (New > gRPC Request)\n2. Ou grpcurl en ligne de commande\n\nVoir la description du dossier parent pour les instructions compl√®tes."
          }
        }
      ]
    }
  ]
}

